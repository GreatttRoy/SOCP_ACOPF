# 二阶锥交流潮流优化模型 (SOCP AC OPF)

## 1. 决策变量

### 1.1 支路变量
对于每个时段 $t \in \{0, 1, \ldots, T-1\}$ 和每条支路 $(i,j) \in E$：

- $P_{t,i,j}$: 支路 $(i,j)$ 在时段 $t$ 的有功功率 (p.u.)，$P_{t,i,j} \in [-2.5, 2.5]$
- $Q_{t,i,j}$: 支路 $(i,j)$ 在时段 $t$ 的无功功率 (p.u.)，$Q_{t,i,j} \in [-2.5, 2.5]$
- $l_{t,i,j}$: 支路 $(i,j)$ 在时段 $t$ 的电流幅值平方 (p.u.)，$l_{t,i,j} \in [0, 2.5]$

### 1.2 节点变量
对于每个时段 $t$ 和每个节点 $i \in N$：

- $v_{t,i}$: 节点 $i$ 在时段 $t$ 的电压幅值平方 (p.u.)，$v_{t,i} \in [V_{\min}^2, V_{\max}^2] = [0.81, 1.21]$
- $p_{t,i}$: 节点 $i$ 在时段 $t$ 的有功注入功率 (p.u.)，$p_{t,i} \in (-\infty, +\infty)$
- $q_{t,i}$: 节点 $i$ 在时段 $t$ 的无功注入功率 (p.u.)，$q_{t,i} \in (-\infty, +\infty)$

### 1.3 发电机变量
对于每个时段 $t$ 和每台发电机 $g \in G$：

- $P_{g,t,g}$: 发电机 $g$ 在时段 $t$ 的有功出力 (p.u.)，$P_{g,t,g} \in [P_{g,\min}(t), P_{g,\max}(t)]$
- $Q_{g,t,g}$: 发电机 $g$ 在时段 $t$ 的无功出力 (p.u.)，$Q_{g,t,g} \in (-\infty, +\infty)$

### 1.4 可调负荷变量
对于每个时段 $t$ 和每个可调负荷 $dr \in DR$：

- $P_{DR,t,dr}$: 可调负荷 $dr$ 在时段 $t$ 的削减量 (p.u.)，$P_{DR,t,dr} \in [P_{DR,\min}(t), P_{DR,\max}(t)]$
  - 注：正数表示实际削减负荷

## 2. 目标函数

最小化所有时段所有支路的电流幅值平方之和：

$$
\min \sum_{t=0}^{T-1} \sum_{(i,j) \in E} l_{t,i,j}
$$

## 3. 约束条件

### 3.1 根节点电压约束
对于每个时段 $t$：

$$
v_{t,0} = 1.0^2 = 1.0
$$

其中节点 0 为电源节点（平衡节点），电压幅值恒定为 1.0 p.u.

### 3.2 节点净注入功率约束
对于每个时段 $t$ 和每个节点 $j \in N$：

**有功功率平衡：**
$$
p_{t,j} = \sum_{g \in G_j} P_{g,t,g} + \sum_{dr \in DR_j} P_{DR,t,dr} + P_{d,t,j}
$$

**无功功率平衡：**
$$
q_{t,j} = \sum_{g \in G_j} Q_{g,t,g} + Q_{d,t,j}
$$

其中：
- $G_j$: 连接在节点 $j$ 的发电机集合
- $DR_j$: 连接在节点 $j$ 的可调负荷集合
- $P_{d,t,j}, Q_{d,t,j}$: 节点 $j$ 在时段 $t$ 的固定负荷（负值表示消耗）

### 3.3 潮流平衡约束（Branch Flow Model）
对于每个时段 $t$ 和每个节点 $j \in N$：

**有功潮流平衡：**
$$
p_{t,j} = \sum_{(j,k) \in E} P_{t,j,k} - \sum_{(i,j) \in E} \left( P_{t,i,j} - r_{ij} \cdot l_{t,i,j} \right)
$$

**无功潮流平衡：**
$$
q_{t,j} = \sum_{(j,k) \in E} Q_{t,j,k} - \sum_{(i,j) \in E} \left( Q_{t,i,j} - x_{ij} \cdot l_{t,i,j} \right)
$$

其中：
- 第一项：从节点 $j$ 流出的功率
- 第二项：流入节点 $j$ 的功率减去线路损耗

### 3.4 电压降落约束（DistFlow Model）
对于每个时段 $t$ 和每条支路 $(i,j) \in E$：

$$
v_{t,j} = v_{t,i} - 2\left( r_{ij} P_{t,i,j} + x_{ij} Q_{t,i,j} \right) + \left( r_{ij}^2 + x_{ij}^2 \right) l_{t,i,j}
$$

其中：
- $r_{ij}$: 支路 $(i,j)$ 的电阻 (p.u.)
- $x_{ij}$: 支路 $(i,j)$ 的电抗 (p.u.)

### 3.5 二阶锥松弛约束
对于每个时段 $t$ 和每条支路 $(i,j) \in E$：

$$
\left(2P_{t,i,j}\right)^2 + \left(2Q_{t,i,j}\right)^2 + \left(l_{t,i,j} - v_{t,i}\right)^2 \leq \left(l_{t,i,j} + v_{t,i}\right)^2
$$

该约束是对原始非凸约束 $l_{t,i,j} \cdot v_{t,i} = P_{t,i,j}^2 + Q_{t,i,j}^2$ 的凸松弛。

等价形式为：
$$
\left\| \begin{bmatrix} 2P_{t,i,j} \\ 2Q_{t,i,j} \\ l_{t,i,j} - v_{t,i} \end{bmatrix} \right\|_2 \leq l_{t,i,j} + v_{t,i}
$$

### 3.6 发电机出力约束
对于每个时段 $t$ 和每台发电机 $g \in G$：

$$
P_{g,\min}(t) \leq P_{g,t,g} \leq P_{g,\max}(t)
$$

其中 $P_{g,\min}(t)$ 和 $P_{g,\max}(t)$ 是时变的发电机出力上下限。

### 3.7 可调负荷约束
对于每个时段 $t$ 和每个可调负荷 $dr \in DR$：

$$
P_{DR,\min}(t) \leq P_{DR,t,dr} \leq P_{DR,\max}(t)
$$

其中 $P_{DR,\min}(t)$ 和 $P_{DR,\max}(t)$ 是时变的可调负荷调节范围。

### 3.8 电压上下限约束
对于每个时段 $t$ 和每个节点 $i \in N$：

$$
V_{\min}^2 \leq v_{t,i} \leq V_{\max}^2
$$

其中 $V_{\min} = 0.9$ p.u., $V_{\max} = 1.1$ p.u.

## 4. 参数说明

### 4.1 网络拓扑参数
- $N$: 节点集合，$|N| = $ num_n（节点总数）
- $E$: 支路集合，每条支路表示为 $(i, j, r_{ij}, x_{ij})$
- $r_{ij}$: 支路 $(i,j)$ 的电阻 (p.u.)
- $x_{ij}$: 支路 $(i,j)$ 的电抗 (p.u.)

### 4.2 时间参数
- $T$: 时间断面数（优化的时段数）
- $t$: 时段索引，$t \in \{0, 1, \ldots, T-1\}$

### 4.3 设备参数
- $G$: 发电机集合，$|G| = $ num_gen（发电机总数）
- $DR$: 可调负荷集合，$|DR| = $ num_dr（可调负荷总数）
- $G_j$: 连接在节点 $j$ 的发电机集合
- $DR_j$: 连接在节点 $j$ 的可调负荷集合

### 4.4 负荷参数
- $P_{d,t,j}$: 节点 $j$ 在时段 $t$ 的固定有功负荷 (p.u.)（负值表示消耗）
- $Q_{d,t,j}$: 节点 $j$ 在时段 $t$ 的固定无功负荷 (p.u.)（负值表示消耗）

### 4.5 电压限制参数
- $V_{\min} = 0.9$ p.u.: 电压下限
- $V_{\max} = 1.1$ p.u.: 电压上限

## 5. 模型特点

1. **凸优化问题**：通过二阶锥松弛，将非凸的交流潮流问题转化为凸优化问题
2. **多时段优化**：考虑多个时间断面的联合优化
3. **辐射网络**：适用于辐射状配电网络
4. **精确性**：在满足相角恢复条件时，二阶锥松弛可以得到原问题的精确解

## 6. 潮流结果计算公式

在求解优化问题得到最优解后，可以通过以下公式恢复相角信息并计算完整的潮流结果。

### 6.1 节点相角计算

对于时段 $t$，首先计算节点相角向量 $\boldsymbol{\theta}_t$：

$$
\boldsymbol{\theta}_t = (A_t^T)^{-1} \boldsymbol{\beta}_t
$$

其中：
- $A_t$: 节点-支路关联矩阵（按国内教材惯例需取转置）
- $\boldsymbol{\beta}_t$: 支路相角差向量，通过相角恢复条件计算得到
- $\theta_i$: 节点 $i$ 的相角（弧度），需要转换为角度时乘以 $\frac{180}{\pi}$

### 6.2 支路功率相量

对于支路 $(i,j)$，支路复功率为：

$$
S_{ij} = P_{t,i,j}^* + j Q_{t,i,j}^*
$$

其中 $P_{t,i,j}^*$ 和 $Q_{t,i,j}^*$ 为优化问题的最优解。

支路功率的相角：
$$
\angle S_{ij} = \arctan\left(\frac{Q_{t,i,j}^*}{P_{t,i,j}^*}\right)
$$

### 6.3 支路电流相量

支路电流的幅值和相角为：

$$
I_{ij} = \sqrt{l_{t,i,j}^*} \cdot e^{j(\theta_i - \angle S_{ij})}
$$

其中：
- $l_{t,i,j}^*$: 优化问题得到的支路电流幅值平方
- $\theta_i$: 节点 $i$ 的相角（弧度）
- $\angle S_{ij}$: 支路功率的相角

电流的幅值和相角分别为：
- 幅值: $|I_{ij}| = \sqrt{l_{t,i,j}^*}$
- 相角: $\angle I_{ij} = \theta_i - \angle S_{ij}$（弧度）

### 6.4 节点电压相量

对于节点 $j$（除平衡节点外），节点电压相量为：

$$
V_j = \sqrt{v_{t,j}^*} \cdot e^{j\theta_j}
$$

其中：
- $v_{t,j}^*$: 优化问题得到的节点电压幅值平方
- $\theta_j$: 节点 $j$ 的相角（弧度）

电压的幅值和相角分别为：
- 幅值: $|V_j| = \sqrt{v_{t,j}^*}$
- 相角: $\angle V_j = \theta_j$（弧度）

### 6.5 节点注入复功率

节点 $j$ 的注入复功率为：

$$
s_{0,j} = p_{t,j}^* + j q_{t,j}^*
$$

其中 $p_{t,j}^*$ 和 $q_{t,j}^*$ 为优化问题的最优解。

### 6.6 相角单位转换

在实际计算中，相角常需要在弧度和角度之间转换：
- 弧度转角度: $\theta_{度} = \theta_{弧度} \times \frac{180}{\pi}$
- 角度转弧度: $\theta_{弧度} = \theta_{度} \times \frac{\pi}{180}$

### 6.7 计算流程

1. **求解优化问题**：获得 $P_{t,i,j}^*$, $Q_{t,i,j}^*$, $l_{t,i,j}^*$, $v_{t,i}^*$, $p_{t,i}^*$, $q_{t,i}^*$ 等变量的最优值

2. **相角恢复**：通过相角恢复条件计算 $\boldsymbol{\beta}_t$，进而计算节点相角 $\boldsymbol{\theta}_t = (A_t^T)^{-1} \boldsymbol{\beta}_t$

3. **计算相量**：
   - 支路功率相量: $S_{ij} = P_{t,i,j}^* + j Q_{t,i,j}^*$
   - 支路电流相量: $I_{ij} = \sqrt{l_{t,i,j}^*} \cdot e^{j(\theta_i - \angle S_{ij})}$
   - 节点电压相量: $V_j = \sqrt{v_{t,j}^*} \cdot e^{j\theta_j}$
   - 节点注入相量: $s_{0,j} = p_{t,j}^* + j q_{t,j}^*$

4. **提取幅值和相角**：使用 $|z|$ 获取幅值，使用 $\angle z$ 获取相角

---

**注**：该模型基于 Branch Flow Model (BFM) 和二阶锥松弛技术，适用于辐射状配电网的最优潮流计算。
